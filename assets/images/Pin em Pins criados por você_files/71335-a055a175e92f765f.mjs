(self.modernJsonp=self.modernJsonp||[]).push([["71335"],{903760:function(e,t,r){r.d(t,{D:()=>c,q:()=>l});var a=r(667294),i=r(825332),n=r(378888),o=r(785893);let s=(0,a.createContext)(!1);function c({children:e}){let t=(()=>{let e=(0,i.TH)();return e.state?.isAppFactoryOAuth||((0,n.mB)(e.search).next??"").startsWith("/app-factory-oauth/")})(),[r,c]=(0,a.useState)(t);return(0,a.useEffect)(()=>{t&&c(!0)},[t]),(0,o.jsx)(s,{value:r,children:e})}function l(){return(0,a.useContext)(s)}},420817:function(e,t,r){r.d(t,{Z:()=>G});var a=r(825332),i=r(78730),n=r(346955),o=r(20256),s=r(667835),c=r(15667),l=r(647709),d=r(785893);function u({children:e}){let t=(0,s.vs)(),r=(0,l.HG)(),{locale:a}=(0,c.B)();return(0,d.jsx)(o.Ag,{colorScheme:t&&!r?"dark":"light",children:(0,d.jsx)(o.Ho,{languageMode:{"ar-SA":"tall","bn-IN":"tall","hi-IN":"tall","te-IN":"tall","ko-KR":"ck","zh-CN":"ck","zh-TW":"ck",ja:"ja","th-TH":"th","vi-VN":"vi"}[a]??"default",children:e})})}function p({children:e}){let t=(0,l.ml)();return(0,d.jsx)(o.Q_,{deviceType:t?"mobile":"desktop",children:e})}var m=r(667294);let h=[];function f({children:e}){let t=(0,c.B)();(0,m.useMemo)(()=>({web_gestalt_calico:{anyEnabled:!0,group:"enabled"}}),[]);let r=h.reduce((e,r)=>({...e,[r]:t.experimentsClient.checkExperiment(r)}),{});return(0,d.jsx)(o.II,{value:r,children:e})}var _=r(603316);function v(e){(0,_.nP)("gestalt-component-impression",{tags:{component:e}})}var g=r(816358),w=r(611282),y=r(104659);function b({children:e}){let{sheetMobileHandlers:t,linkHandlers:r,radioGroupHandlers:a,datePickerHandlers:i,dateFieldHandlers:n,dateRangeHandlers:s}=function(){let{setAppFocusState:e}=(0,y.G)(),t=(0,m.useCallback)(()=>{g.Z.pause(),e(!1)},[e]),r=(0,m.useCallback)(()=>{g.Z.resume(),e(!0)},[e]),a=(0,m.useMemo)(()=>({onOpen:t,onClose:r}),[t,r]),i=(0,m.useMemo)(()=>({onRender:()=>{v("RadioGroup")}}),[]),n=(0,m.useMemo)(()=>({onRender:()=>{v("DateField")}}),[]),o=(0,m.useMemo)(()=>({onRender:()=>{v("DatePicker")}}),[]),s=(0,m.useMemo)(()=>({onRender:()=>{v("DateRange")}}),[]);return{linkHandlers:(0,m.useMemo)(()=>({onNavigation:({href:e,target:t})=>(0,w.Z)({href:e,target:t})}),[]),sheetMobileHandlers:a,radioGroupHandlers:i,dateFieldHandlers:n,datePickerHandlers:o,dateRangeHandlers:s}}();return(0,d.jsx)(o.uu,{dateFieldHandlers:n,datePickerHandlers:i,dateRangeHandlers:s,linkHandlers:r,radioGroupHandlers:a,sheetMobileHandlers:t,children:e})}var E=r(390843),P=r(35814),x=r(903760),T=r(274320),k=r(368177),D=r(901360),I=r(616550),N=r(529547),C=r(622481),j=r(282803),Z=r(392824),S=r(735201),A=r(524447),B=r(293169);let L=e=>["/advertiser/"].reduce((t,r)=>e.includes(r)||t,!1);function O({children:e,immutableLocation:t,routerHistoryAction:r,staticContext:a}){let i=(0,m.useRef)(null),n=(0,m.useRef)(null),o=(0,m.useRef)(t),s=(0,m.useRef)(!0),{path:c,params:l}=(0,I.$B)(),u=(0,m.useRef)(c),p=(0,m.useRef)(l),h=(0,N.Z)(a.deviceType);if(s.current&&(0,S.ZP)(!0,a.serverData?.trace_id),(0,m.useEffect)(()=>{u.current=c},[c]),(0,m.useEffect)(()=>{p.current=l},[l]),(0,m.useEffect)(()=>{(0,A.UQ)(),s.current=!1},[]),L(t.pathname)?o.current.pathname!==t.pathname:o.current!==t){o.current=t,n.current=window.performance?.now?window.performance.now():null;let{current:e}=n;if(!s.current){let t=!i.current;(0,D.A9)("routeStart",{tags:{action:r}}),(0,B.Eg)(t),(0,A.Ux)(t),(0,A.on)(),(0,Z.tl)(),(0,S._T)(),(0,S.ZP)(!1);let{defaultBufferSize:a}=(0,B.LH)();e&&((0,D.A9)("routeStart.defaultBufferSize",{count:a}),i.current={time:e,action:r})}}return(0,d.jsx)(j.Z,{value:h?a:null,children:(0,d.jsx)(C.Z,{value:i.current,children:e})})}var R=r(939672),H=r(30880),U=r(754545),F=r(956077);function M({children:e,immutableLocation:t,routerHistoryAction:r}){let a=(0,m.useRef)(!0),i=(0,m.useRef)(!1),n=(0,m.useRef)(!1),o=(0,m.useRef)(t),s=performance.now(),{group:c}=(0,T.r)().checkExperiment("web_pwt_validate_suspense");return c&&(0,_.nP)("pwt_logger_v4_render",{sampleRate:1,tags:{experimentGroup:c}}),i.current=i.current||L(t.pathname)?o.current.pathname!==t.pathname:o.current!==t,i.current&&!n.current&&((0,U.yh)("routeChange"),n.current=!0,(0,R.N0)(),c&&(0,_.nP)("pwt_logger_v4_route_change_reset",{sampleRate:1,tags:{experimentGroup:c}})),(0,m.useLayoutEffect)(()=>{if((L(t.pathname)?o.current.pathname!==t.pathname:o.current!==t)||a.current){o.current=t;let e=a.current?0:s;(0,U.ep)(r,e,a.current),(0,F.Nx)("NavigationCompletev4"),a.current=!1,i.current=!1,n.current=!1,c&&(0,_.nP)("pwt_logger_v4_navigation_complete",{sampleRate:1,tags:{experimentGroup:c}})}},[a,r,t,s,i]),e}function z({children:e,immutableLocation:t,routerHistoryAction:r}){return(0,H.Z)()?(0,d.jsx)(R.mW,{children:(0,d.jsx)(M,{immutableLocation:t,routerHistoryAction:r,children:e})}):e}var V=r(791948);function W({children:e,traceLoggerData:t}){let r=(0,c.B)(),i=(0,a.ur)(),n=(0,a.TH)(),{group:o}=(0,T.r)().checkExperiment("web_pwt_validate_suspense"),s=(0,k.Z)({requestContext:r,traceLoggerData:t});return(0,D.iF)(i),"enabled_switch_v4_v3"===o?(0,d.jsx)(z,{immutableLocation:n,routerHistoryAction:i,children:(0,d.jsx)(O,{immutableLocation:n,routerHistoryAction:i,staticContext:s,children:e})}):(0,d.jsx)(O,{immutableLocation:n,routerHistoryAction:i,staticContext:s,children:(0,d.jsx)(z,{immutableLocation:n,routerHistoryAction:i,children:e})})}function G({children:e,context:t,otaData:r,inContextTranslation:a,requestContext:o,resourceCreator:s,traceLoggerData:c}){let{anyEnabled:l}=(0,T.r)().checkExperiment("web_pwt_validate_suspense"),m=(0,d.jsx)(p,{children:(0,d.jsx)(f,{children:(0,d.jsx)(u,{children:(0,d.jsx)(E.nK,{children:(0,d.jsx)(y.g,{children:(0,d.jsx)(b,{children:(0,d.jsx)(n.Ih,{children:(0,d.jsx)(x.D,{children:(0,d.jsx)(V.UZ,{resourceCreator:s,children:e})})})})})})})})});return(0,d.jsx)(i.E,{value:t,children:l?(0,d.jsx)(W,{traceLoggerData:c,children:(0,d.jsx)(P.Z,{enableInContextTranslation:a,locale:o.locale,otaData:r,children:m})}):(0,d.jsx)(P.Z,{enableInContextTranslation:a,locale:o.locale,otaData:r,children:(0,d.jsx)(W,{traceLoggerData:c,children:m})})})}},641527:function(e,t,r){let a,i;r.d(t,{li:()=>T,Ch:()=>w,nc:()=>k,a:()=>D,ZP:()=>I,cA:()=>x});var n=r(172045),o=r(898582),s=r(575108),c=r(296086),l=r(973160),d=r(346955),u=r(810288),p=r(991384),m=r(2420),h=r(734215),f=r(664450),_=r(603316);let v=new Set([6945,170,3700]),g=new Set([3700]),w={3829:"articleImpressions",18:"pinImpressions",3700:"boardImpressions",3803:"searchImpressions",170:"storyImpression",3704:"userImpressions"},y=[4700,4701,4702,4703,7042,7043],b=e=>(0,u.Z)(JSON.stringify(e)),E=e=>v.has(e);function P(){let e=new Date;a?a&&a.getUTCDate()!==e.getUTCDate()&&(a=e,(0,c.Z)()):a=e}let x=e=>{let t=e.event_type,r=y.includes(t),a=(0,d.BE)();return!!r||13===t||!!a},T=(e,t)=>{let r=e.event_type,a=y.includes(r),i=(0,d.BE)();return a?e:13===r&&e.view_type?(t?.({viewType:e.view_type,viewParameter:e.view_parameter,viewData:i?.viewData?(0,p.Z)(i.viewData,e.view_data):e.view_data}),e):!i||e.view_type&&e.view_parameter?e:{...e,view_type:i.viewType||e.view_type,view_parameter:i.viewParameter,view_data:e.view_data?(0,p.Z)(e.view_data,i.viewData):i.viewData}},k=(e,t)=>{let{component:r,element:a}=e,i=e.object_id_str,n=e.view_type,o=e.event_type,{appState:s}=e;return(e.event_data?.[t]||[]).map(c=>{var l;let d;return{auxData:e.aux_data,...r?{component:r}:{},eventData:c,...o?{eventType:o}:{},...n?{viewType:n}:{},viewData:e.view_data,viewParameter:e.view_parameter,...i?{objectIdStr:i}:null,impressionType:t,...(l=e.event_data,d={},l?.storyPinProductEventData&&(d={...d,storyPinProductEventData:l.storyPinProductEventData}),d),appState:s,...a?{element:a}:{}}})??[]},D=(e,t)=>({...e.component?{component:e.component}:{},...e.object_id_str?{objectIdStr:e.object_id_str}:null,...e.view_type?{viewType:e.view_type}:{},eventType:e.event_type,auxData:e.aux_data,impressionType:t,viewData:e.view_data,viewParameter:e.view_parameter,eventData:e.event_data});function I(){let e=[],t=[],r=0;function a(){return[...e,...t.reduce((e,t)=>{let r=e.find(e=>e.view_type===t.viewType&&e.view_parameter===t.viewParameter&&e.event_type===t.eventType&&e.object_id_str===t.objectIdStr&&(0,h.Z)(e.view_data,t.viewData));if(r&&!E(t.eventType))t.impressionType in r.event_data?r.event_data[t.impressionType].push(t.eventData):r.event_data[t.impressionType]=[t.eventData];else{let r,a=t.storyPinProductEventData?{storyPinProductEventData:t.storyPinProductEventData}:{},i={appState:t.appState,aux_data:t.auxData||{},clientUUID:(0,n.Z)(),component:t.component,event_data:{...a,[t.impressionType]:!E(r=t.eventType)||E(r)&&g.has(r)?[t.eventData]:{...t.eventData,...(t.eventData||{})[t.impressionType]}},event_type:t.eventType,object_id_str:t.objectIdStr||void 0,time:(0,l.Z)(),view_data:t.viewData,view_parameter:t.viewParameter,view_type:t.viewType,element:t.element};e.push(i)}return e},[])]}function c({error:e,isError:t,isDroppedEvent:r,isImpression:a,isEventSkipped:i}){let n,s=(0,o.Z)(),c=s?.userAgent||{},l=!(c.isMobile||c.isTablet),d={error_message:e?.message??"unknown",appType:l?"WEB_DENZEL":"WEB_MOBILE",country:s?.country??"unknown",browserName:c.browserName,osName:c.osName,browserType:c.browserType,browserVersion:c.browserVersion,isError:t,isImpression:a,isEventSkipped:i};n=r?"dropped":t?"errors":i?"skipped":"success",(0,_.nP)(`webapp.metrics.contextLog.indexdb.${n}`,{tags:d})}async function d(){try{await i?.clear()}catch(e){c({isError:!0,error:{message:"Error while clearing cache",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}function u(){e=[],t=[],r=0}async function p(e){try{let t={...e,cache_created_time:(0,l.Z)(),isImpression:!1,aux_data:{...e.aux_data,is_context_cached:!0}};await i?.setItem((0,n.Z)(),t)}catch(e){c({isError:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}async function v(e){try{let t={...e,cache_created_time:(0,l.Z)(),isImpression:!0,auxData:{...e.auxData,is_impression_cached:!0}};await i?.setItem((0,n.Z)(),t)}catch(e){c({isError:!0,isImpression:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}async function w(){let e=a(),t=0,r=1e3;if(!e.length)return;let i=s.Z.create("ApiCResource",{events:e,report_time:(0,l.Z)()}),n=async()=>{try{await i.callCreate({async:!0,showError:!1}),d()}catch(i){let a=!i?.api_error_code||[m.dO,m.cZ,m.i1].includes(i.api_error_code);if(!function({retryAttempts:e,error:t,events:r}){let a=(0,o.Z)(),i=a?.userAgent||{},n=!(i.isMobile||i.isTablet),s={error_code:t?.api_error_code??"unknown",retryAttempts:e,appType:n?"WEB_DENZEL":"WEB_MOBILE",country:a?.country??"unknown",browserName:i.browserName,eventSize:r.length,osName:i.osName,browserType:i.browserType,browserVersion:i.browserVersion};(0,_.nP)("metrics_quality_web_retry_error_log",{tags:s})}({retryAttempts:t,error:i,events:e}),a&&t<5){let e=r;t+=1,r*=2,setTimeout(n,e)}else d()}};n(),u(),P()}async function y(){try{(await i?.getAllItem()||[]).forEach(r=>{let{value:a}=r,{cache_created_time:i,isImpression:n,...o}=a;(0,l.Z)()-i>864e11?c({isDroppedEvent:!0,isError:!1}):(0,l.Z)()-i<6e10?c({isEventSkipped:!0}):n?(t.push(o),c({isImpression:!0,isError:!1})):(e.push(o),c({isError:!1}))})}catch(e){c({isError:!0,error:{message:"Error while syncing cached events",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}finally{w(),d()}}return{flushContextEvents:w,getContextEvents:a,logContextEvent:function({object_id_str:t,...a}){let i=(0,l.Z)(),o={aux_data:{},event_data:{},view_data:{},...a,time:i,clientUUID:(0,n.Z)(),...t?{object_id_str:t}:null},s=function(e){if(!e)return e;let{element:t,eventData:r,component:a,objectId:i,view:n,viewParameter:o,viewData:s,durationNs:c,pairId:l,clientTrackingParams:d,...u}=e;return u}(o.aux_data);o={...o,aux_data:s},r+b(o)>20480&&w(),e.push(o),r+=b(o),P(),p(o)},logImpression:function(e){r+b(e)>20480&&w(),t.push(e),r+=b(e),v(e)},resetEventsBuffer:u,syncCachedEndEvents:y,_getIndexDBInstance:function(){return i},initiateIndexDBCache:function(){window?.indexedDB&&(i=i||new f.Z(window.indexedDB,"ContextLoggingDB","ContextLoggingTable"))}}}},973160:function(e,t,r){r.d(t,{Z:()=>i,s:()=>a});let a=()=>{let e,t;return"undefined"!==document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),{hidden:e,visibilityChange:t}},i=()=>1e6*Date.now()},622481:function(e,t,r){r.d(t,{Z:()=>a});let a=(0,r(667294).createContext)(null)},282803:function(e,t,r){r.d(t,{Z:()=>a});let a=(0,r(667294).createContext)(null)},664450:function(e,t,r){r.d(t,{Z:()=>a});class a{constructor(e,t="myDatabase",r="myStore"){var a,i,n;a="cache",i=new Map,(a="symbol"==typeof(n=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(a,"string"))?n:n+"")in this?Object.defineProperty(this,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):this[a]=i,this.dbName=t,this.storeName=r,this.dbPromise=(async()=>{try{return await this.initializeDB(e)}catch{return null}})()}async initializeDB(e){return new Promise((t,r)=>{try{let a=e.open(this.dbName,1);a.onerror=()=>{r(Error("IndexedDB initialization error: "+a.error))},a.onupgradeneeded=()=>{let e=a.result;e.objectStoreNames.contains(this.storeName)||e.createObjectStore(this.storeName,{keyPath:"key"})},a.onsuccess=()=>{t(a.result)}}catch(e){r(Error("IndexedDB initialization error: "+e))}})}async reopenDatabaseIfClosed(){let e=await this.dbPromise;return e&&!e.close?e:(this.dbPromise=this.initializeDB(window.indexedDB),this.dbPromise)}async getObjectStore(e="readwrite"){let t=await this.reopenDatabaseIfClosed();return t?t.transaction(this.storeName,e).objectStore(this.storeName):null}async getItem(e){if(this.cache.has(e))return this.cache.get(e)??null;let t=await this.getObjectStore();return t?new Promise((r,a)=>{let i=t.get(e);i.onerror=()=>a(i.error),i.onsuccess=()=>{let t=i.result?.value||null;null!==t&&this.cache.set(e,t),r(t)}}):null}async getAllItem(){let e=await this.getObjectStore();return e?new Promise((t,r)=>{let a=e.getAll();a.onerror=()=>r(a.error),a.onsuccess=()=>{a.result?.forEach(e=>{this.cache.set(e.key,e.value)}),t(a.result)}}):null}async setItem(e,t){this.cache.set(e,t);let r=await this.getObjectStore();return r?new Promise((a,i)=>{let n=r.put({key:e,value:t});n.onerror=()=>{i(n.error)},n.onsuccess=()=>{a(null)}}):null}async removeItem(e){this.cache.delete(e);let t=await this.getObjectStore();return t?new Promise((r,a)=>{let i=t.delete(e);i.onerror=()=>a(i.error),i.onsuccess=()=>r(null)}):null}async clear(){this.cache.clear();let e=await this.getObjectStore();return e?new Promise((t,r)=>{let a=e.clear();a.onerror=()=>r(a.error),a.onsuccess=()=>t(null)}):null}}},121793:function(e,t,r){let a;r.d(t,{w:()=>f});var i=r(898582),n=r(973160),o=r(664450),s=r(732888),c=r(510928),l=r(603316);function d(e,t,r){var a;return(t="symbol"==typeof(a=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,t||"default");if("object"!=typeof a)return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?a:a+"")in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let u=null,p="ACTIVE",m="PAUSED",h=()=>window&&window.performance&&window.performance.now?`(Time: ${(window.performance.now()/1e3).toFixed(3)}s)`:"";function f({contextLogger:e}){if(a||(a=window?.indexedDB?new o.Z(window.indexedDB,"EventLoggingDB","TimeSpent"):null),u)return u;let t=new Map,r=(0,c.Z)()&&(0,c.Z)().debug_timespent,f=[],_=r?console:{error:(...e)=>{},log:(...e)=>{},group:(...e)=>{},groupEnd:(...e)=>{}};return console.group||(_.group=(...e)=>console.log(...e),_.groupEnd=(...e)=>{}),u=new class{constructor(){d(this,"appTimedPair",null),d(this,"clickthroughProperties",null),d(this,"historyStackContext",null),d(this,"offsiteTimedPair",null),d(this,"offsiteTimedPairForegroundId",null),d(this,"pins",Object.freeze({})),d(this,"addEventListeners",()=>{var e;let t,{hidden:r,visibilityChange:a}=(0,n.s)(),i=e=>{document[r]?this.unregisterApp(void 0,e):this.registerApp()};a&&document.addEventListener(a,i,!1),window.addEventListener("focus",this.registerApp),window.addEventListener("blur",e=>this.unregisterApp(void 0,e));let o=(e=e=>this.unregisterApp(void 0,e),t=!1,(...r)=>{t||(t=!0,e(...r))});window.addEventListener("beforeunload",o),window.addEventListener("pagehide",o);let s=navigator&&navigator.userAgent.toLowerCase();s&&s.includes("macintosh")&&s.includes("chrome")&&window.addEventListener("popstate",()=>{document.hasFocus()||document[r]||(0,l.nP)("chrome_mac_back_forward_button",{sampleRate:1})})}),d(this,"storeClickthroughProperties",e=>{this.clickthroughProperties&&(0,l.nP)("webapp.metrics.clickthroughs.overwritten",{sampleRate:1,tags:{previousView:this.clickthroughProperties.view_type,previousViewParameter:this.clickthroughProperties.view_parameter,nextView:e.view_type,nextViewParameter:e.view_parameter}}),this.clickthroughProperties={time:(0,n.Z)(),...e}}),d(this,"clearClickthroughProperties",()=>{this.clickthroughProperties=null,this.offsiteTimedPair=null,this.offsiteTimedPairForegroundId=null}),d(this,"registerApp",()=>{_.group("App Foreground",h()),null==this.appTimedPair?(this.appTimedPair=new s.Z,this.appTimedPair.start(),this._unpauseAllComponents(),this._endOffsiteTimedPair(),null!==this.appTimedPair&&void 0!==this.appTimedPair&&e.logContextEvent({event_type:4700,pair_id:this.appTimedPair.uuid})):_.error("TimedPair already exists for app."),_.groupEnd()}),d(this,"logIndexDbStatLog",({error:e,isError:t,isDroppedEvent:r})=>{let a,n=(0,i.Z)(),o=n?.userAgent||{},s=!(o.isMobile||o.isTablet),c={error_message:e?.message??"unknown",appType:s?"WEB_DENZEL":"WEB_MOBILE",country:n?.country??"unknown",browserName:o.browserName,osName:o.osName,browserType:o.browserType,browserVersion:o.browserVersion,isError:t,errorName:e?.errorName??"unknown",errorDetails:e?.details??"unknown",errorStackTrace:e?.stack_trace??"unknown"};a=r?"dropped":t?"errors":"success",(0,l.nP)(`webapp.metrics.timespent.indexdb.${a}`,{tags:c})}),d(this,"unregisterApp",(t=!1,r)=>{_.group("App Background",h());let{appTimedPair:a}=this;if(null!=a){this._pauseAllComponents();let t=a.end();this._startOffsiteTimedPair(),e.logContextEvent({event_type:4701,duration_ns:t,pair_id:a.uuid}),this.appTimedPair=null}else _.error("No TimedPair found for app.");let i=["beforeunload","pagehide"],n=i.includes(r?.type||""),o=i.includes(r?.pauseReason||"");(n||o)&&this._endOffsiteTimedPair(),t||e.flushContextEvents(),_.groupEnd()}),d(this,"_activateComponent",t=>{_.group("Activating component",h()),r&&_.log(t.getContext());let a=t.getTimedPair();if(a){a.start();let{view:r,viewParameter:i,component:n,element:o,objectId:s,clientTrackingParams:c}=t.getLoggerContext();e.logContextEvent({event_type:4702,view_type:r,view_parameter:i,component:n,element:o,object_id_str:s,view_data:t.props.viewData,pair_id:a.uuid,clientTrackingParams:c,aux_data:{time_spent_foreground_pairid:this.appTimedPair&&this.appTimedPair.uuid,time_spent_parent_pairid:t.getParentId(),...t.props.auxData}})}_.groupEnd()}),d(this,"_deactivateComponent",t=>{_.group("Deactivating component",h()),r&&_.log(t.getContext());let a=t.getTimedPair();if(a){let{view:r,viewParameter:i,component:n,element:o,objectId:s,clientTrackingParams:c}=a,l=a.end();e.logContextEvent({event_type:4703,view_type:r,view_parameter:i,component:n,element:o,object_id_str:s,view_data:t.props.viewData,duration_ns:l,pair_id:a.uuid,clientTrackingParams:c,aux_data:{time_spent_foreground_pairid:this.appTimedPair&&this.appTimedPair.uuid,time_spent_parent_pairid:t.getParentId(),...t.props.auxData}})}_.groupEnd()}),d(this,"_startOffsiteTimedPair",()=>{let{clickthroughProperties:t}=this;t&&(this.offsiteTimedPair=new s.Z({view:186,viewParameter:t.view_parameter,objectId:t.object_id_str}),this.offsiteTimedPair.start(),this.offsiteTimedPairForegroundId=this.appTimedPair?this.appTimedPair.uuid:null,t={...t,aux_data:{...t.aux_data,time_to_offsite:void 0!==t.time&&null!==t.time&&"number"==typeof t.time?(0,n.Z)()-t.time:void 0}},e.logContextEvent({...t,event_type:4702,view_type:186,pair_id:this.offsiteTimedPair?this.offsiteTimedPair.uuid:null,aux_data:{...t.aux_data,time_spent_foreground_pairid:this.offsiteTimedPairForegroundId}}),this._addOffSitePairToIndexDB({offsiteTimedPairUUID:this.offsiteTimedPair?.uuid,clickthroughProperties:t,timeCreated:this.offsiteTimedPair?.startTime,offsiteTimedPairForegroundId:this.offsiteTimedPairForegroundId}))}),d(this,"_endOffsiteTimedPair",()=>{let{offsiteTimedPair:t,clickthroughProperties:r}=this;if(t&&r){let a=t.end();e.logContextEvent({...r,event_type:4703,view_type:186,pair_id:this.offsiteTimedPair?this.offsiteTimedPair.uuid:null,aux_data:{...r.aux_data,time_spent_foreground_pairid:this.offsiteTimedPairForegroundId},duration_ns:a}),this._removeOffSitePairByIdFromIndexDB(this.offsiteTimedPair?.uuid),this._syncCachedTimedPairEndEvents(),this._onOffsiteEnd(),this.clearClickthroughProperties()}else this._syncCachedTimedPairEndEvents()}),d(this,"_addOffSitePairToIndexDB",async({offsiteTimedPairUUID:e,clickthroughProperties:t,timeCreated:r,offsiteTimedPairForegroundId:i})=>{try{await a?.setItem(e,{clickthroughProperties:{...t},timeCreated:r,offsiteTimedPairForegroundId:i})}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),d(this,"_addAppTimerToIndexDB",async({foregroundAppTimerUUID:e,timeCreated:t})=>{try{await a?.setItem(e,{timeCreated:t})}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be added",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),d(this,"_removeAppTimerFromIndexDB",async({foregroundAppTimerUUID:e})=>{try{if(!e)return;await a?.removeItem(e)}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be removed",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),d(this,"_removeOffSitePairByIdFromIndexDB",async e=>{try{if(!e)return;await a?.removeItem(e)}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Transaction could not be removed",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),d(this,"_syncCachedTimedPairEndEvents",async()=>{try{(await a?.getAllItem()||[]).forEach(async t=>{let{key:r,value:a}=t,{clickthroughProperties:i,timeCreated:n,offsiteTimedPairForegroundId:o}=a,c=(0,s.h)();n&&(0,s.h)()-n>864e11?this.logIndexDbStatLog({isDroppedEvent:!0,isError:!1}):(e.logContextEvent({...i,event_type:4703,view_type:186,pair_id:r||null,aux_data:{...i?.aux_data,time_spent_foreground_pairid:o,is_timed_pair_cached:!0},duration_ns:n?c-n:null}),this.logIndexDbStatLog({isError:!1}))}),await a?.clear()}catch(e){this.logIndexDbStatLog({isError:!0,error:{message:"Error while syncing cached events",details:e instanceof Error?e.message:"Unknown error",stack_trace:e instanceof Error?e.stack??"No stack trace available":"No stack trace available",errorName:e instanceof Error?e.name:"N/A"}})}}),d(this,"_onOffsiteEnd",()=>{_.group("Trigger onOffsiteEndCallbacks"),f.forEach(e=>e({appTimedPair:this.appTimedPair,clickthroughProperties:this.clickthroughProperties,offsiteTimedPair:this.offsiteTimedPair,offsiteTimedPairForegroundId:this.offsiteTimedPairForegroundId})),_.groupEnd()}),d(this,"_pauseAllComponents",()=>{_.group("Pause all components"),t.forEach((e,t,r)=>{e===p&&this._deactivateComponent(t),r.set(t,m)}),_.groupEnd()}),d(this,"_unpauseAllComponents",()=>{_.group("Unpause all components"),t.forEach((e,r)=>{let a=new s.Z(r.getLoggerContext());r.setTimedPair(a,()=>{t.set(r,p),this._activateComponent(r)})}),_.groupEnd()})}setHistoryStackContext(e){this.historyStackContext=e}setPins(e){this.pins=e}startOffsiteRightClickTimedPair(t=!1){this._startOffsiteTimedPair(),t||e.flushContextEvents()}registerComponent(e){null===this.appTimedPair?t.set(e,m):(t.set(e,p),this._activateComponent(e))}unregisterComponent(e){t.get(e)===p&&(this._deactivateComponent(e),e.setTimedPair(new s.Z(e.getLoggerContext()))),t.delete(e)}size(){return t.size}onOffsiteEnd(e){f.push(e)}removeOnOffsiteEnd(e){let t=f.indexOf(e);t>-1&&f.splice(t,1)}_getIndexDBInstance(){return a}_getContextLogger(){return e}_clearTimeSpentManager(){u=null}}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/71335-a055a175e92f765f.mjs.map